{
  "hash": "84e1e6adaae658db93ccfefd8bcc142b",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Analyzing the impacts of temperature on rockfish recruitment in the Channel Islands\"\ndate: 12/4/2025\n\n---\n## Background\n\n\n## About the data\nThe data quantifying Rockfish recruitment comes from the Partnership of Interdiscpilnary Sciences of Coastal Oceans (PISCO) long-term fish recruitment monitoring in the Channel Islands. The YOYs were collected using Subtidal Mooring U R F (SMURFs) that were placed just off the coast of the Northern Channel Islands in an attempt to collect fish as they swam to structure. Monitoring took place from 2000-2020, with collections occuring year round starting in 2012. \n\nThe temperature data \n\n## Hypotheses\nH0: Temperature has no effect on rockfish recruitment\n\nHa: Increased temperature has a positive effect on rockfish recruitment\n\n\n## Load necessary packages and data\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.2     ✔ tibble    3.3.0\n✔ lubridate 1.9.4     ✔ tidyr     1.3.1\n✔ purrr     1.1.0     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(knitr)\nlibrary(pscl)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nClasses and Methods for R originally developed in the\nPolitical Science Computational Laboratory\nDepartment of Political Science\nStanford University (2002-2015),\nby and under the direction of Simon Jackman.\nhurdle and zeroinfl functions by Achim Zeileis.\n```\n\n\n:::\n\n```{.r .cell-code}\nsmurf <- read_csv(here::here(\"posts\", \"eds222-final-project\", \"data\", \"PISCO_UCSB_subtidal_recruitment_fish_data.1.2.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 143472 Columns: 9\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (2): site_code, classcode\ndbl (7): year, month, day, num_smurfs, soak_days, total_fish_collected, recr...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\nsmurf_sp <- read_csv(here::here(\"posts\", \"eds222-final-project\", \"data\", \"PISCO_UCSB_subtidal_recruitment_fish_spp_list.1.2.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 56 Columns: 12\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (12): classcode, genus, species, description, taxonomic_source, aphiaID,...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n\n```{.r .cell-code}\n# Data for ocean temperature and upwelling\nocean <- read_csv(here::here(\"posts\", \"eds222-final-project\", \"data\", \"ALL_OCEAN_DATA.csv\"))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 7019 Columns: 62\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr  (4): Date, Date_30, Date_60, SST_maxPLD_30\ndbl (58): mean_sst, SST_D30, SST_D60, SST_meanPLD_30, SST_minPLD_30, SST_mea...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n\n## Exploring df\n\n::: {.cell}\n\n```{.r .cell-code}\nrecruits <- left_join(smurf, smurf_sp)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(classcode)`\n```\n\n\n:::\n\n```{.r .cell-code}\nrecruits$Date <- as.Date(paste(recruits$year, recruits$month, recruits$day, sep = \"/\"))\nocean$Date <- as.Date(ocean$Date, format = \"%m/%d/%Y\")\n\nrecruit_ocean <- left_join(recruits, ocean)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nJoining with `by = join_by(Date)`\n```\n\n\n:::\n\n```{.r .cell-code}\nrf_yoy <- recruit_ocean %>% \n  filter(year >= 2012  &\n        (month >= 2 & month <= 7)) %>% \n  filter(str_detect(site_code, \"HAZ\")| # Filter data for on Pelican and Hazards sample sites\n            str_detect(site_code, \"PEL\")) %>% \n  filter(classcode == \"KGBC\" | classcode == \"SCAR/SCAU\" | classcode == \"SATR\") #KGB - SCAR/SCAU - SATR - PCLA\n\nkb_yoy <- recruit_ocean %>% \n  filter((classcode == \"PCLA\") & \n           (year >= 2012) &\n        (month >= 7 & month <= 11)) %>% \n  filter(str_detect(site_code, \"HAZ\")| # Filter data for on Pelican and Hazards sample sites\n            str_detect(site_code, \"PEL\"))\n  \n      \n  \nsummarized_yoy <- rf_yoy %>% \n  group_by(classcode, year) %>% \n  summarise(count = sum(total_fish_collected))\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'classcode'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n\n```{.r .cell-code}\nhighest_rf <- recruits %>% \n  filter(genus == \"Sebastes\") %>% \n  group_by(classcode) %>% \n  summarise(count = sum(total_fish_collected)) %>% \n  filter(count >= 1000)\n\nmost_yoy <- highest_rf$classcode\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrf_yoy_av <- rf_yoy %>% \n  group_by(classcode, year) %>% \n  summarise(av_fish = mean(total_fish_collected)) %>% \n  ungroup()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n`summarise()` has grouped output by 'classcode'. You can override using the\n`.groups` argument.\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(rf_yoy_av, aes(year, av_fish)) +\n  geom_line(aes(color = classcode))\n```\n\n::: {.cell-output-display}\n![](exploringata-copy_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(rf_yoy, aes(month, total_fish_collected)) +\n  geom_jitter(aes(color = classcode))\n```\n\n::: {.cell-output-display}\n![](exploringata-copy_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nggplot(kb_yoy, aes(month, total_fish_collected)) +\n  geom_jitter()\n```\n\n::: {.cell-output-display}\n![](exploringata-copy_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\n::: {.cell}\n\n```{.r .cell-code}\nfor(i in seq_along(rf_yoy)){\n  if (rf_yoy$total_fish_collected[i] >= 1)\n    {rf_yoy$success[i] <- 1}\n    else\n      {rf_yoy$success[i] <- 0}\n}\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nWarning: Unknown or uninitialised column: `success`.\n```\n\n\n:::\n:::\n\n\n\n## Statistical analysis\nIn order to analyze this data, I selected a hurdle model because the data contains many 0's. Hurdle models are a type of heirarchal model that first tests presence and absence (0 and 1), then tests abundance without the presence of 0s. =\n\n$$FishPresence ~ binomial(1, p)$$\n$$\nlogit(p) = B0 + B1 * SST\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nx <- seq(min(rf_yoy$SST_D30),max(rf_yoy$SST_D30), length.out = 1)\n\nB0 <- 3\nB1 <- -0.1\n\n\nlogit_p <- B0 + B1 * x\n\np <- exp(logit_p) / \n  (1 + exp(logit_p))\n\n# Simulate presences and absence\nsuccess <- rbinom(n = 1000, size = 1, prob = p)\n```\n:::\n\n\n$$Fishcount ~ NegativeBinomial(r, p)$$\n$$\nlog(p) = B2 + B3 * SST\n$$\n\n\n::: {.cell}\n\n```{.r .cell-code}\nB2 <- 2\nB3 <- 0.1\n\nlog_mu <- B2 + B3 * x\nmu <- exp(log_mu)\n\n# Simulate count data\ncount <- rnbinom(n = 1000, size = 1.5, mu = mu)\n```\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nrf_presence_model <- glm(success ~ SST_D30,  # formula: response ~ resp\n                   data = rf_yoy, # data remains unchanged\n                   family = binomial(link = \"logit\"))\n\nsummary(rf_presence_model)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nglm(formula = success ~ SST_D30, family = binomial(link = \"logit\"), \n    data = rf_yoy)\n\nCoefficients:\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept) -16.2208     3.5199  -4.608 4.06e-06 ***\nSST_D30       1.4602     0.2795   5.225 1.74e-07 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 167.97  on 431  degrees of freedom\nResidual deviance: 128.76  on 430  degrees of freedom\nAIC: 132.76\n\nNumber of Fisher Scoring iterations: 7\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nB0 <- 3\nB1 <- -0.1\n\n\nlogit_p <- B0 + B1 * x\n\np <- exp(logit_p) / \n  (1 + exp(logit_p))\n\n# Simulate presences and absence\nsuccess <- rbinom(n = 1000, size = 1, prob = p)\n\nB2 <- 2\nB3 <- 0.1\n\nlog_mu <- B2 + B3 * x\nmu <- exp(log_mu)\n\n# Simulate count data\ncount <- rnbinom(n = 1000, size = 1.5, mu = mu)\n\n\n# Create actual count (factor in successes and failures)\nactual_count <- success * count\n\n\nsimulated_data <- as_tibble(expand_grid(x, actual_count))\n\nsimulated_success <- as_tibble(expand_grid(x, success))\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nglm(success ~ x,\n    data = simulated_success,\n    family = binomial(link = \"logit\"))\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:  glm(formula = success ~ x, family = binomial(link = \"logit\"), \n    data = simulated_success)\n\nCoefficients:\n(Intercept)            x  \n      1.937           NA  \n\nDegrees of Freedom: 999 Total (i.e. Null);  999 Residual\nNull Deviance:\t    757.4 \nResidual Deviance: 757.4 \tAIC: 759.4\n```\n\n\n:::\n:::\n\n\n\nUsing \n\n::: {.cell}\n\n:::\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmod.hurdle <- hurdle(total_fish_collected ~ SST_D30, \n                     data = rf_yoy, \n                     dist = \"negbin\", \n                     zero.dist = \"binomial\",\n                     link = \"logit\")\n\nsummary(mod.hurdle)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nCall:\nhurdle(formula = total_fish_collected ~ SST_D30, data = rf_yoy, dist = \"negbin\", \n    zero.dist = \"binomial\", link = \"logit\")\n\nPearson residuals:\n    Min      1Q  Median      3Q     Max \n-0.3741 -0.3440 -0.3118 -0.1969 12.7959 \n\nCount model coefficients (truncated negbin with log link):\n            Estimate Std. Error z value Pr(>|z|)\n(Intercept)  -1.3873    46.5863  -0.030    0.976\nSST_D30      -0.2135     0.1725  -1.238    0.216\nLog(theta)  -10.2047    46.5350  -0.219    0.826\nZero hurdle model coefficients (binomial with logit link):\n            Estimate Std. Error z value Pr(>|z|)    \n(Intercept)  4.98451    1.26751   3.933 8.41e-05 ***\nSST_D30     -0.32214    0.09027  -3.569 0.000359 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1 \n\nTheta: count = 0\nNumber of iterations in BFGS optimization: 213 \nLog-likelihood: -1461 on 5 Df\n```\n\n\n:::\n:::\n\n\nBEUTI\n\nSST\n",
    "supporting": [
      "exploringata-copy_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}