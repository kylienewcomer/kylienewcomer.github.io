{
  "hash": "0bc315ebfef4984219767a89c3953c86",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"EEZs for Aquaculture\"\nauthor: \"Kylie Newcomer\"\ndate: 11/29/2025\nformat: pdf\neditor: visual\nexecute: \n  warning: false\n  message: false\n---\n\n\n::: {.cell}\n\n```{.r .cell-code}\nknitr::include_graphics(\"images/intro.png\")\n```\n\n::: {.cell-output-display}\n![](images/intro.png){fig-pos='H' width=5.94in}\n:::\n\n```{.r .cell-code}\nknitr::include_graphics(\"images/data.png\")\n```\n\n::: {.cell-output-display}\n![](images/data.png){fig-pos='H' width=4.54in}\n:::\n\n```{.r .cell-code}\nknitr::include_graphics(\"images/ref.png\")\n```\n\n::: {.cell-output-display}\n![](images/ref.png){fig-pos='H' width=4.54in}\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\nlibrary(sf)\nlibrary(terra)\nlibrary(here)\nlibrary(tmap)\nlibrary(kableExtra)\n```\n:::\n\n\n## Read in data\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsst_08 <- rast(here(\"data\", \"average_annual_sst_2008.tif\"))\n\nsst_09 <- rast(here(\"data\", \"average_annual_sst_2009.tif\"))\n\nsst_10 <- rast(here(\"data\", \"average_annual_sst_2010.tif\"))\n\nsst_11 <- rast(here(\"data\", \"average_annual_sst_2011.tif\"))\n\nsst_12 <- rast(here(\"data\", \"average_annual_sst_2012.tif\"))\n\ndepth <- rast(here(\"data\", \"depth.tif\"))\n\neez <- st_read(here(\"data\", \"wc_regions_clean.shp\"))\n```\n:::\n\n\n## Process data\n\nAll temperature rasters from 2008 to 2012 are stacked. The mean of all temperature rasters is taken to determine the average sea surface temperature. The temperature is converted from Kelvins to degrees celsius.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nall_sst <- c(sst_08,\n             sst_09,\n             sst_10,\n             sst_11,\n             sst_12)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Rename layers to correspond with years\nlayer_names <- c(\"2008\", \"2009\", \"2010\", \"2011\", \"2012\")\n\nnames(all_sst) <- layer_names\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check names are updated\nnames(all_sst)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n[1] \"2008\" \"2009\" \"2010\" \"2011\" \"2012\"\n```\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find average across years\nmean_sst <- mean(all_sst) - 273.15 # convert from Kelvin to Celsius\n```\n:::\n\n\n## Find suitable locations\n\nIn order to determine suitable areas of habitat, reclassification matrices are created to assign 1's to areas within the suitable temperature and depth ranges for Oysters. Areas without suitable depth and temperature ranges get assigned a 0. The CRS, extent, and resolution of the reclassified depth raster are updated to match the reclassified temperature raster. The updated depth and temperature rasters are multiplied together to determine which areas are suitable in both temperature and depth requirements. Any cell with a 1 in both temperature and depth will remain 1, while any cell without suitable depth or temperature ranges, or both, will be 0.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Reclassify temperature data\nrcl_temp <- matrix(c(-Inf, 11, 0,\n         11, 30, 1,\n         30, Inf, 0),\n       ncol = 3, byrow = TRUE)\n\n\ntemp_reclass <- classify(mean_sst, rcl = rcl_temp)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Reclassify depth data\nrcl_depth <- matrix(c(-Inf, -70, 0,\n         -70, 0, 1,\n         0, Inf, 0),\n       ncol = 3, byrow = TRUE)\n\ndepth_reclass <- classify(depth, rcl = rcl_depth)\n\ndepth_reclass\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \nsize        : 5040, 4320, 1  (nrow, ncol, nlyr)\nresolution  : 0.004166667, 0.004166667  (x, y)\nextent      : -132, -114, 29, 50  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 (EPSG:4326) \nsource(s)   : memory\nvarname     : depth \nname        : depth \nmin value   :     0 \nmax value   :     1 \n```\n\n\n:::\n:::\n\n\nNeed to update depth raster to match temperature raster\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# If-else statement to check/update CRS\nif (crs(depth_reclass) == crs(temp_reclass)){\n  print(\"Projections match!\")\n}else {\n  crs(depth_reclass) <- crs(temp_reclass)\n  warning(\"Updating depth CRS\")\n}\n# Match resolutions of rasters\ndepth_resample <- resample(depth_reclass, temp_reclass, method = \"near\")\n\n# Match extents of depth and temp rasters\ncropped_depth <- crop(depth_resample, temp_reclass)\n\n# Stack temperature and depth rasters\ntemp_depth <- c(temp_reclass, cropped_depth)\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Multiply temperature and depth rasters together\nocean <- temp_reclass * cropped_depth\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Check new raster to make sure multiplcation worked\nocean[[1]]\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nclass       : SpatRaster \nsize        : 480, 408, 1  (nrow, ncol, nlyr)\nresolution  : 0.04166185, 0.04165702  (x, y)\nextent      : -131.9848, -114.9867, 29.99305, 49.98842  (xmin, xmax, ymin, ymax)\ncoord. ref. : lon/lat WGS 84 \nsource(s)   : memory\nname        : mean \nmin value   :    0 \nmax value   :    1 \n```\n\n\n:::\n:::\n\n\n# Mapping suitable habitat from multiplied rasters\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Looking at suitable habitat based on new raster\ntm_shape(ocean) +\n  tm_raster(col.scale = tm_scale(\n    breaks = c(0,1,Inf),\n    values = c(\"lightblue2\", \"black\"),\n    labels = c(\"Not Suitable\", \"Suitable\")),\n    col.legend = tm_legend(\n     title = \"Suitable habitat\",\n     position = tm_pos_out(\"right\", \"center\")\n    )) +\n  tm_grid(alpha = 0.4)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-13-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n## Find suitable cells within raster\n\nIn order to determine suitable habitat cells within each region of west coast EEZ's, the CRS of the eez data must be updated to match the ocean raster. An ocean raster mask based on the eez data is created to exclude any cells outside of the west coast EEZ's. The eez data is rasterized based on the ocean mask raster to use algebra on the data for finding the total number of suitable cells within each EEZ. The area of an individual cell is calculated and multiplied with the number of cells to determine the area of suitable habitat in each EEZ. The suitable habitat areas are then joined with the eez data map the total area of suitable habitat per region.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Update CRS eez to match ocean CRS\nif (crs(eez) == crs(ocean)){\n  print(\"Projections match!\")\n}else {\n  st_crs(eez) <- crs(ocean)\n  warning(\"Updating eez CRS\")\n}\n\n# Create mask based on eez values\nocean_mask <- mask(ocean, eez)\n\neez_raster <- rasterize(eez, ocean_mask,\n                        field = \"rgn\")\n```\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsuitable_cells <- zonal(ocean_mask, eez_raster, fun = \"sum\", na.rm = TRUE)\n\nsuitable_cells %>% \n  kable(col.names = c(\"Region\", \"Number of cells with suitable habitat\")) %>%\n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE)\n```\n\n::: {.cell-output-display}\n\n\\begin{longtable}[t]{lr}\n\\toprule\nRegion & Number of cells with suitable habitat\\\\\n\\midrule\nCentral California & 238\\\\\nNorthern California & 11\\\\\nOregon & 71\\\\\nSouthern California & 211\\\\\nWashington & 162\\\\\n\\bottomrule\n\\end{longtable}\n\n\n:::\n:::\n\n\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find the area of individual cell\ncell_area <- cellSize(ocean_mask, unit=\"km\")[1]\n\n# Calculate total area of suitable habitat per region\nsuitable_cell_area <- suitable_cells %>%\n  rename(cells = mean) %>%\n  mutate(cell_area = cell_area$area,\n        suitable_habitat = cells * cell_area) %>% \n  select(-cell_area)\n\n# Table with calculated cells and area per region\nsuitable_cell_area %>% \n  arrange(desc(cells)) %>% \n  kable(col.names = c(\"Region\", \"Number of cells with suitable habitat\", \"Area of suitable habitat\")) %>%\n  kable_styling(bootstrap_options = \"striped\", full_width = FALSE)\n```\n\n::: {.cell-output-display}\n\n\\begin{longtable}[t]{lrr}\n\\toprule\nRegion & Number of cells with suitable habitat & Area of suitable habitat\\\\\n\\midrule\nCentral California & 238 & 3296.1331\\\\\nSouthern California & 211 & 2922.2021\\\\\nWashington & 162 & 2243.5864\\\\\nOregon & 71 & 983.3002\\\\\nNorthern California & 11 & 152.3423\\\\\n\\bottomrule\n\\end{longtable}\n\n\n:::\n:::\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Join suitable area with west coast eez data\nsuitable_habitat <- left_join(eez, suitable_cell_area, by = \"rgn\")\n```\n:::\n\n\n# Map suitable area by west coast EEZ's\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Map the results\ntm_shape(ocean) +                                      \n  tm_raster(col.legend = tm_legend(show = FALSE)) +\ntm_shape(suitable_habitat) +\n  tm_polygons(fill = \"suitable_habitat\", \n              fill.scale = tm_scale(values =  \"viridis\"),\n                                    #breaks = c(0,200,1000,2500,3000, Inf)),\n              fill.legend = tm_legend(title  = \"Suitable habitat (sq km)\")) + \n  tm_text(text = \"rgn\", # Add labels for each region\n          col = \"white\",\n          size = 0.35,\n          xmod = 4,\n          ymod = 1,\n          bgcol = \"black\",\n          bgcol_alpha = 0.75)+\ntm_grid(alpha = 0.5) +\ntm_title(\"Suitable Aquaculture Zones for Oysters\")\n```\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-18-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n## Create function\n\n\n::: {.cell}\n\n```{.r .cell-code}\naquaculture_zones <- function(species, min_depth, max_depth, min_temp, max_temp){\n  # Temp reclassification\n  rcl_temp <- matrix(c(-Inf, min_temp, 0,\n         min_temp, max_temp, 1,\n         max_temp, Inf, 0),\n       ncol = 3, byrow = TRUE)\n    \n  temp_reclass <- classify(mean_sst, rcl = rcl_temp)\n  \n  # Depth reclassification\n  rcl_depth <- matrix(c(-Inf, min_depth, 0,\n         min_depth, max_depth, 1,\n         max_depth, Inf, 0),\n       ncol = 3, byrow = TRUE)\n  depth_reclass <- classify(depth, rcl = rcl_depth)\n\n  # Adjust CRS to match\n  crs(depth_reclass) <- crs(temp_reclass)\n \n  # Match resolutions of rasters\n  depth_resample <- resample(depth_reclass, temp_reclass, method = \"near\")\n\n  # Match extents of depth and temp rasters\n  cropped_depth <- crop(depth_resample, temp_reclass)\n\n  # Create raster denoting suitable depth AND temperature ranges\n  ocean <- cropped_depth * temp_reclass\n  \n  # Change EEZ CRS\n  st_crs(eez) <- crs(ocean)\n  \n  # Mask ocean data outside of EEZ regions\n  ocean_mask <- mask(ocean, eez)\n\n  # Rasterize eez data based on ocean mask\n  eez_raster <- rasterize(eez, ocean_mask,\n                          field = \"rgn\")\n\n  # Add up number of suitable cells per region\n  suitable_cells <- zonal(ocean_mask, eez_raster, fun = \"sum\", na.rm = TRUE)\n\n  # Determine cell size\n  cell_area <- cellSize(ocean_mask, unit=\"km\")[1]\n\n  # Calulcate area of suiable habitat based on number of suitable cells and cell size\n  suitable_cell_area <- suitable_cells %>%\n    rename(cells = depth) %>%\n    mutate(cell_area = cell_area$area,\n          suitable_habitat = cells * cell_area) %>% \n    select(-cell_area)\n  \n  # Join EEZ regions and suitable area\n  suitable_habitat <- left_join(eez, suitable_cell_area, by = \"rgn\")\n  \n  # Create map\n  tm_shape(ocean) +                                      \n    tm_raster(col.legend = tm_legend(show = FALSE)) +\n    tm_shape(suitable_habitat) +\n    tm_polygons(fill = \"suitable_habitat\", \n                fill.scale = tm_scale(values =  \"viridis\"),\n                                    #breaks = c(0,200,1000,2500,3000, Inf)),\n                fill.legend = tm_legend(title  = \"Suitable habitat (sq km)\")) + \n    tm_text(text = \"rgn\",\n            col = \"white\",\n            size = 0.35,\n            xmod = 4,\n            ymod = 1,\n            bgcol = \"black\",\n            bgcol_alpha = 0.75)+\n    tm_grid(alpha = 0.5) +\n    tm_title(paste(\"Suitable Aquaculture Zones for\", species))\n}\n# Test function with Oysters\naquaculture_zones(species = \"Oysters\", min_depth = -70, max_depth = 0, min_temp =  11, max_temp = 35)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-19-1.pdf){fig-pos='H'}\n:::\n:::\n\n\n# Use function for new specis of interest\n\nRed Abalone were previously a popular fishery across the west coast, however the fishery closed in 2018 due to declining populations. The only source of Red Abalone on the west coast is currently through aquaculture. Because this species was a popular fishery and still has demand across the west coast, utilizing aquaculture zones along the coast would increase supply for this sought after mollusk. The depth range for Red Abalone is 0-24m and the temperature range is 8-18 ÂºC.\n\n\n::: {.cell}\n\n```{.r .cell-code}\naquaculture_zones(species = \"Red Abalone\", min_depth = -24, max_depth = 0, min_temp =  8, max_temp = 18)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-pdf/unnamed-chunk-20-1.pdf){fig-pos='H'}\n:::\n:::\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "\\usepackage{booktabs}\n\\usepackage{longtable}\n\\usepackage{array}\n\\usepackage{multirow}\n\\usepackage{wrapfig}\n\\usepackage{float}\n\\usepackage{colortbl}\n\\usepackage{pdflscape}\n\\usepackage{tabu}\n\\usepackage{threeparttable}\n\\usepackage{threeparttablex}\n\\usepackage[normalem]{ulem}\n\\usepackage{makecell}\n\\usepackage{xcolor}\n"
      ]
    },
    "engineDependencies": {},
    "preserve": null,
    "postProcess": false
  }
}